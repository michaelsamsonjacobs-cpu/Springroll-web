<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal | Springroll Team</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getFirestore, doc, getDoc, setDoc, deleteDoc, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDaqDdWnZOeL2MXbc__eUA4dlb1Fs8-na0",
            authDomain: "springroll-171de.firebaseapp.com",
            projectId: "springroll-171de"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Admin emails - only these can access this page
        const ADMIN_EMAILS = ['mike@qluulab.com', 'ao@qluulab.com', 'rico@qluulab.com'];

        window.handleSignIn = async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                alert('Sign in failed: ' + error.message);
            }
        };

        window.handleSignOut = () => signOut(auth);

        window.addUser = async () => {
            const email = document.getElementById('new-email').value.toLowerCase().trim();
            if (!email || !email.includes('@')) {
                alert('Please enter a valid email');
                return;
            }
            try {
                await setDoc(doc(db, 'allowed_users', email), { added: new Date().toISOString() });
                document.getElementById('new-email').value = '';
                loadUsers();
                alert('‚úÖ Added: ' + email);
            } catch (e) {
                alert('Error: ' + e.message);
            }
        };

        window.removeUser = async (email) => {
            if (!confirm('Remove access for ' + email + '?')) return;
            try {
                await deleteDoc(doc(db, 'allowed_users', email));
                loadUsers();
            } catch (e) {
                alert('Error: ' + e.message);
            }
        };

        async function loadUsers() {
            const list = document.getElementById('user-list');
            list.innerHTML = '<div class="text-slate-500">Loading...</div>';
            try {
                const snapshot = await getDocs(collection(db, 'allowed_users'));
                if (snapshot.empty) {
                    list.innerHTML = '<div class="text-slate-500">No users yet</div>';
                    return;
                }
                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const email = doc.id;
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-3 bg-white/5 rounded-lg';
                    div.innerHTML = `
                        <span class="text-white">${email}</span>
                        <button onclick="removeUser('${email}')" class="text-red-400 hover:text-red-300 text-sm">Remove</button>
                    `;
                    list.appendChild(div);
                });
                document.getElementById('user-count').textContent = snapshot.size + ' users';
            } catch (e) {
                list.innerHTML = '<div class="text-red-400">Error loading users</div>';
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user && ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('admin-name').textContent = user.displayName;
                loadUsers();
            } else if (user) {
                alert('Access denied. Not an admin.');
                signOut(auth);
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('admin-panel').classList.add('hidden');
            }
        });
    </script>
    <style>
        body {
            background: #020617;
            color: #f8fafc;
            font-family: system-ui, sans-serif;
            min-height: 100vh;
        }
    </style>
</head>

<body class="p-8">
    <!-- Login -->
    <div id="login-screen" class="max-w-md mx-auto mt-20 text-center">
        <h1 class="text-2xl font-bold mb-4">üîê Admin Portal</h1>
        <p class="text-slate-400 mb-6">Sign in with your admin Google account</p>
        <button onclick="handleSignIn()" class="bg-white text-black px-6 py-3 rounded-lg font-semibold">Sign in with
            Google</button>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden max-w-2xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-2xl font-bold">üë§ User Management</h1>
            <div class="flex items-center gap-4">
                <span class="text-slate-400" id="admin-name"></span>
                <button onclick="handleSignOut()" class="text-sm text-slate-500 hover:text-white">Sign Out</button>
            </div>
        </div>

        <!-- Add User -->
        <div class="bg-slate-800/50 p-6 rounded-xl mb-6">
            <h2 class="font-bold mb-4">Add New User</h2>
            <div class="flex gap-3">
                <input id="new-email" type="email" placeholder="customer@gmail.com"
                    class="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-white"
                    onkeydown="if(event.key==='Enter')addUser()">
                <button onclick="addUser()"
                    class="bg-green-600 hover:bg-green-500 px-6 py-2 rounded-lg font-semibold">Add</button>
            </div>
        </div>

        <!-- User List -->
        <div class="bg-slate-800/50 p-6 rounded-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold">Allowed Users</h2>
                <span id="user-count" class="text-sm text-slate-500"></span>
            </div>
            <div id="user-list" class="space-y-2"></div>
        </div>
    </div>
</body>

</html>